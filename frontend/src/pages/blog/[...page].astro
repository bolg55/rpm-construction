---
import Blogcard from '@/components/blogcard.astro';
import Pagination from '@/components/ui/pagination.astro';
import {
  type BlogPage,
  type Pagination as PaginationType,
} from '@/interfaces/blog-interface';
import PageLayout from '@/layouts/PageLayout.astro';
import { formatBlogPosts } from '@/utils/formatBlogPosts';
import { getCollection, type CollectionEntry } from 'astro:content';

export const getStaticPaths = async ({ paginate }: PaginationType) => {
  const blogPosts = await getCollection('blog');
  const formattedPosts: CollectionEntry<'blog'>[] = formatBlogPosts(blogPosts, {
    sortByDate: true,
  });
  return paginate(formattedPosts, { pageSize: 4 });
};
const { page } = Astro.props as { page: BlogPage };
---

<PageLayout
  title='Blog'
  description='This is the Blog'
  pageTitle='Blog'
  subtitle='Latest Posts'
  whiteBG={true}
>
  <ul class='grid gap-16 max-w-4xl mx-auto mt-4 sm:mt-16'>
    {page?.data.map((post, index) => <Blogcard {post} {index} />)}
  </ul>

  <div class='text-center mt-24 space-y-4 text-secondary'>
    <Pagination prevUrl={page?.url.prev} nextUrl={page?.url.next} />
    <p class='text-sm'>Page {page?.currentPage} of {page?.lastPage}</p>
  </div>
</PageLayout>
